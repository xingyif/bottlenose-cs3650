<% @page_title = "Registrations" %>

<div class="page-header">
  <h1>Registrations</h1>

  <div class="actions">
    <%= link_to "New Registration(s)", new_staff_course_registration_path(@course), class: "btn btn-success" %>
  </div>
</div>

<div class="row">
  <div class="col-md-6">
    <h2>Teachers</h2>
    <% if @course.staff_registrations.empty? %>
      <div class="well">
        No teachers.
      </div>
    <% else %>
      <table class="table table-striped">
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Show in Reports</th>
          <th>&nbsp;</th>
        </tr>

        <% @course.staff_registrations.each do |treg| %>
          <% teacher = treg.user %>
          <tr>
            <td><%= teacher.name %></td>
            <td><%= teacher.email %></td>
            <td>
              <span class="show-user-<%= treg.id %>"><%= treg.show_in_lists? ? "Yes" : "No" %></span>
              (<%= link_to "Toggle", toggle_staff_course_registration_path(@course, treg), method: :post %>)
            </td>
            <td>
              <%= link_to 'Remove', staff_course_registration_path(@course, treg), method: :delete, data: { confirm: 'Are you sure?' } %></td>
          </tr>
        <% end %>
      </table>
    <% end %>

    <h2>Students</h2>
    <% if @course.student_registrations.empty? %>
      <div class="well">
        No students.
      </div>
    <% else %>
      <table class="table table-striped">
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Show In Reports</th>
          <th>&nbsp;</th>
        </tr>

        <% @course.student_registrations.each do |sreg| %>
          <% student = sreg.user %>
          <tr>
            <td><%= link_to student.name, staff_user_path(student) %></td>
            <td><%= student.email %></td>
            <td>
              <span class="show-user-<%= sreg.id %>"><%= sreg.show_in_lists? ? "Yes" : "No" %></span>
              (<%= link_to "Toggle", toggle_staff_course_registration_path(@course, sreg), method: :post %>)
            </td>
            <td>
              <%= link_to 'Remove', staff_course_registration_path(@course, sreg), method: :delete, data: { confirm: 'Are you sure?' } %>
            </td>
          </tr>
        <% end %>
      </table>
    <% end %>
  </div>

  <div class="col-md-6">
    <h2>Requests</h2>

    <% if @course.reg_requests.empty? %>
      <div class="well">
        No requests.
      </div>
    <% else %>
      <table class="table table-striped">
        <tr>
          <th>Name</th>
          <th>Role</th>
          <th>Email</th>
          <th>Note</th>
          <th>&nbsp;</th>
        </tr>

        <% @course.reg_requests.each do |request| %>
          <tr>
            <td><%= link_to request.user.name, staff_user_path(request.user) %></td>
            <td><%= request.role %></td>
            <td><%= request.user.email %></td>
            <td><%= request.notes %></td>
            <td width="65">
              <div class="btn-group pull-right" role="group">
                <%= link_to staff_course_reg_request_accept_path(@course, request), method: :delete, class: "btn btn-success btn-xs" do %>
                  <span class="glyphicon glyphicon-ok"></span>
                <% end %>
                <%= link_to staff_course_reg_request_reject_path(@course, request), method: :delete, class: "btn btn-danger btn-xs" do %>
                  <span class="glyphicon glyphicon-remove"></span>
                <% end %>
              </div>
            </td>
          </tr>
        <% end %>
      </table>
    <% end %>
  </div>
</div>
