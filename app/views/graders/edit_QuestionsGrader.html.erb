<% @page_title = "JavaStyle Grader" %>
<% cur_reg = current_user.registration_for(@course) %>
<% def maybe_link_to(which, text, link)
     if which then link_to(text, link) else text end
   end %>
<% content_for :wide_content_before do %>
<style id="comment-styles"></style>

<p>
  <%= link_to "Back to submission",
      course_assignment_submission_path(@course, @assignment, @submission) %>
</p>

<h1>Submission</h1>

<table class="table row-vcenter">
  <tr>
    <td><strong>Assignment</strong></td>
    <td><%= @submission.assignment.name %></td>
  </tr>
  <% if @submission.team.nil? %>
    <tr>
      <td><strong>Student</strong></td>
      <td><%= maybe_link_to cur_reg.staff?, @submission.user.name, user_path(@submission.user) %></td>
    </tr>
  <% else %>
    <tr>
      <td><strong>Team</strong></td>
      <td><%= @submission.team %></td>
    </tr>
  <% end %>
  <tr>
    <td><strong>Submission Time</strong></td>
    <td><span class="local-time"><%= @submission.created_at %></span></td>
  </tr>
  <tr>
    <td><strong>Student Notes</strong></td>
    <td>
      <div class="prose"><%= @submission.student_notes %></div>
    </td>
  </tr>
</table>


<h1>Response Grading</h1>
<p>The treeview to the left shows the files in this submission.  Click
  on each one to show that file's content.</p>
<p>Student responses are shown inline with the questions.  The
  grading rubrics for each question follow.</p>

<% unless @answers_are_newer %>
<h3>These responses are for an outdated submission!</h3>
<% end %>

<% end %>

<% content_for :wide_content do %>
<%= form_for [@course, @assignment, @submission, @grader] do |f| %>
<% if @assignment.related_assignment_id %>
<div class="col-sm-6">
  <div id="files-sidebar">
    <div id="files" class="nav treeview condensed"></div>
  </div>
  <div class="tab-content">
    <%= render "submissions/files", sub_files: @submission_files %>
  </div>
  <script>
    <%= render partial: "submissions/render_comments.js" %>
  </script>
  </div>
<% end %>

<% if @assignment.related_assignment_id.nil? %>
<div id="responses" class="form-group container">
<% else %>
<div id="responses" class="form-group col-sm-6">
<% end %>
<%= render "submissions/render_questions" %>
<%= f.submit "Submit grade", id: "completed", class: "btn btn-success" %>
<script>$("form").submit(ensureValidNumericInputOnSubmit);</script>
</div>
<% end %>
<% end %>
