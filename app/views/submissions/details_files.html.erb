<% @page_title = "View Submission Details" %>
<% content_for :wide_content_before do %>
<p>
  <%= link_to "< Back to submission", course_assignment_submission_path(@course, @assignment, @submission) %>
</p>

<h1>Submission</h1>

<table class="table row-vcenter">
  <tr>
    <td><strong>Assignment</strong></td>
    <td><%= @submission.assignment.name %></td>
  </tr>
  <% if @submission.team.nil? %>
    <tr>
      <td><strong>Student</strong></td>
      <td><%= @submission.user.name %></td>
    </tr>
  <% else %>
    <tr>
      <td><strong>Team</strong></td>
      <td><%= @submission.team %></td>
    </tr>
  <% end %>
  <tr>
    <td><strong>Submission Time</strong></td>
    <td><span class="local-time"><%= @submission.created_at %></span></td>
  </tr>
  <tr>
    <td><strong>Student Notes</strong></td>
    <td>
      <div class="prose"><%= @submission.student_notes %></div>
    </td>
  </tr>
</table>
<% end %>

<% content_for :wide_content do %>
<div class="col-sm-3">
  <div id="files-sidebar" data-spy="affix">
    <div id="files" class="nav treeview condensed"></div>
  </div>
</div>
<div class="col-sm-9 tab-content">
  <%= render "files", sub_files: @submission_files %>
</div>

<script>
  var lineComments = <%= raw(JSON.pretty_generate(@submission_files.map{|s| s[:lineComments]})) %>;
  <%= render :partial => 'submissions/render_comments.js' %>
  $(function() { renderComments(lineComments); });
</script>
<% end %>
