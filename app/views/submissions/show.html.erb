<% @page_title = "View Submission" %>
<% cur_reg = current_user.registration_for(@course) %>

<p>
  <%= link_to "Back to Assignment: #{@assignment.name}", course_assignment_path(@course, @assignment) %>
</p>

<h1>Submission</h1>

<table class="table">
  <tr>
    <td><strong>Assignment</strong></td>
    <td><%= @submission.assignment.name %></td>
  </tr>
  <% if @submission.team.nil? %>
    <tr>
      <td><strong>Student</strong></td>
      <td><%= @submission.user.name %></td>
    </tr>
  <% else %>
    <tr>
      <td><strong>Team</strong></td>
      <td><%= @submission.team %> (submitted by <%= @submission.user.name %>)</td>
    </tr>
  <% end %>
  <tr>
    <td><strong>Submission Time</strong></td>
    <td><span class="local-time"><%= @submission.created_at %></span></td>
  </tr>
  <tr>
    <td><strong>Submission Details</strong></td>
    <td><%= link_to "See individual files",
            files_course_assignment_submission_path(@course, @assignment, @submission),
            class: "btn btn-success" %>
      <%= link_to @submission.file_path, class: "btn btn-default" do %>
      <i class="glyphicon glyphicon-download-alt"></i> Download  <%= @submission.file_name %> 
      <% end %>
    </td>
  </tr>
  <tr>
    <td><strong>Student Notes</strong></td>
    <td>
      <div class="prose"><%= @submission.student_notes %></div>
    </td>
  </tr>
</table>

<h1>Scoring Details</h1>

<table class="table table-striped">
<% g = @gradesheet.grades[:grades].find(sub: @submission).first
   all_scores = if cur_reg.staff? then g[:staff_scores] else g[:blind_scores] end 
   @gradesheet.configs.each_with_index do |c, i|
     scores = all_scores[:scores][i] %>
<tr>
  <td><%= c.type %></td>
  <td>
    <% if scores.kind_of?(Array) %>
    <%= scores[0] %>&nbsp;/&nbsp;<%= scores[1] %>
    <% else %>
    <%= scores %>
    <% end %>
  </td>
</tr>
<% end %>
<tr>
  <td>Raw Score:</td>
  <td><%= number_with_precision(all_scores[:raw_score], :precision => 2) %>
    &nbsp;/&nbsp;<%= @gradesheet.max_score %></td>
</tr>
<tr>
  <td>Raw Percentage</td>
  <td><%= number_with_precision(100.0 * (all_scores[:raw_score] / @gradesheet.max_score), :precision => 2) %>%</td>
</tr>
<% if @submission.late? %>
<tr>
  <td>Days Late:</td>
  <td><%= @submission.days_late %></td>
</tr>
<tr>
  <td>Late Penalty:</td>
  <td><%= number_with_precision(@submission.late_penalty, :precision => 2) %>%</td>
</tr>
<% end %>
<tr>
  <td>Total Score:</td>
  <td><%= number_with_precision(@submission.score, :precision => 2) %>%</td>
</tr>
</table>

<!-- <h1>Teacher Notes</h1> -->

<!-- < % if @assignment.hide_grading? %> -->

<!-- <p>(Teacher notes have not yet been shared.)</p> -->

<!-- < % end %> -->

<!-- < % if (not @assignment.hide_grading?) %> -->

<!-- <div class="prose"> -->
<!-- < %= raw @submission.teacher_notes || 'no data' %> -->
<!-- </div> -->

<!--   < % unless @submission.comments_upload_id.nil? %> -->
<!--     <p>Teacher Uploaded: < %= link_to @submission.comments_upload.file_name, -->
<!--       @submission.comments_upload.path %></p> -->
<!--   < % end %> -->

<!-- < % end %> -->

<!-- < % unless @submission.assignment.grading_upload_id.nil? %> -->

<!-- <h1>Autograding Output</h1> -->

<!-- <script> -->
<!--   function reload_bottom() { -->
<!--     window.location.href = window.location.href + "#bottom"; -->
<!--     window.location.reload(true); -->
<!--   } -->
<!-- </script> -->

<!-- <p id="bottom2">< %= link_to_function "Refresh Output", "reload_bottom();" %></p> -->

<!-- <pre> -->
<!-- < % # Lack of indentation important here. %> -->
<!-- < %= @submission.grading_output %> -->
<!-- </pre> -->

<!-- <p id="bottom">< %= link_to_function "Refresh Output", "reload_bottom();" %></p> -->

<!-- < % end %> -->
